<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> Home </ion-title>
    @if(loading$| async){
    <ion-progress-bar type="indeterminate" color="tertiary" />
    }
    <ion-buttons slot="end">
      <ion-button (click)="logOut()">
        <ion-icon slot="icon-only" name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-margin-bottom">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Home</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-searchbar
    placeholder="Search by name"
    animated="true"
    [debounce]="500"
    (ionInput)="filterCharacters($event)"
  ></ion-searchbar>

  <ion-list class="item-list">
    <ion-list-header>
      <ion-grid>
        <ion-row class="items-center">
          <ion-col size="8">
            <ion-label>Rick & Morty Characters</ion-label>
          </ion-col>
          <ion-col size="4" class="ion-text-end">
            <ion-button id="open-modal-filter" [fill]="filter && 'solid'"
              >Filter</ion-button
            >
          </ion-col>
        </ion-row>
        <ion-row>
          @for(category of categories; track $index){
          <ion-col>
            <ion-chip [outline]="true" *ngIf="isCategoryInFilter(category.name)"
              >{{ category.name | titlecase }}: {{ filter[category.name] }}</ion-chip
            >
          </ion-col>
          }
        </ion-row>
      </ion-grid>
    </ion-list-header>
    <ion-item *ngFor="let item of filteredCharacters; trackBy: trackByFn">
      <ion-avatar aria-hidden="true" slot="start">
        <img alt="" [src]="item.image" />
      </ion-avatar>
      <ion-col>
        <ion-label>{{item.name}}</ion-label>
        <ion-label class="label-desc">{{ item.status }}</ion-label>
      </ion-col>
      <ion-col size="3" class="ion-text-end">
        <ion-label>{{ item.gender }}</ion-label>
      </ion-col>
    </ion-item>
  </ion-list>

  <app-dynamic-filter
    title="Filter Characters"
    triggerId="open-modal-filter"
    [categories]="categories"
    (applyFilter)="applyFilter($event)"
  ></app-dynamic-filter>
</ion-content>

<app-pagination
  [showNext]="!!pagination?.next"
  [showPrevious]="!!pagination?.prev"
  (next)="nextPage()"
  (previous)="prevPage()"
></app-pagination>
